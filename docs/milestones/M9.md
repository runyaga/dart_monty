# M9: Platform Expansion (Windows + Mobile)

## Goal

Full platform coverage. Primarily CI/build targets — the Dart logic is
identical to desktop (M5) and inherits all API improvements from M7A/M7B/M8.
The work is cross-compilation, platform bundling, and CI automation.

## Risk Addressed

- Mobile and Windows users cannot use dart_monty
- Cross-compilation toolchains may have surprises (NDK, XCFramework)
- Platform-specific dynamic library loading edge cases

## Dependencies

- M5 (Flutter desktop plugin) — same Dart code, extended to new platforms
- M7A, M7B, M8 — should land first so the expanded platforms ship with
  the complete API surface

## Deliverables

- Windows support in `dart_monty_native`
- `packages/dart_monty_mobile` for iOS and Android
- CI for all three platforms
- Same Dart test suite as M5

## Work Items

### 9.1 Windows

- [ ] CI: Rust build for `x86_64-pc-windows-msvc`
- [ ] `dart_monty_native.dll`
- [ ] `windows/CMakeLists.txt`
- [ ] `DynamicLibrary.open` path handling for Windows
- [ ] Automated test on `windows-latest` CI

### 9.2 iOS

- [ ] Rust cross-compile: `aarch64-apple-ios`, `aarch64-apple-ios-sim`
- [ ] Static library (`.a`) + XCFramework
- [ ] `dart_monty_mobile.podspec` with vendored framework
- [ ] CI: iOS simulator test

### 9.3 Android

- [ ] Rust via cargo-ndk: `arm64-v8a`, `armeabi-v7a`, `x86_64`
- [ ] `.so` per ABI in `jniLibs/`
- [ ] Gradle integration
- [ ] CI: Android emulator test

### 9.4 Automated Tests

- [ ] `tool/test_windows.sh` — build + flutter test on Windows
- [ ] `tool/test_ios.sh` — build + flutter test on iOS simulator
- [ ] `tool/test_android.sh` — build + flutter test on Android emulator
- [ ] Same Dart test suite as M5 (Isolate, lifecycle, callbacks)
- [ ] Python ladder on each platform (at minimum tiers 1-6)

### 9.5 Dartdoc

- [ ] Platform-specific setup instructions in package dartdoc
- [ ] Document platform availability matrix
- [ ] `dart doc` generates cleanly with no warnings

## Quality Gate

```bash
# Each platform:
flutter test --coverage
# Coverage must be >= 90%
flutter analyze --fatal-infos
dart format --set-exit-if-changed .
```

## Test Dependencies

| Tool | Purpose |
|------|---------|
| Flutter SDK | Plugin framework |
| Rust cross-compile targets | Native binaries |
| `cargo-ndk` | Android NDK builds |
| Xcode | iOS builds |
| Windows CI runner | Windows builds |
