# M6: Flutter Web Plugin

**Prerequisite:** M4 (pure Dart WASM package) complete.

## Goal

Flutter web plugin wrapping the pure Dart WASM package (M4) with
federated plugin registration and JS asset bundling.

## Risk Addressed

- **R8** (federated plugin wiring -- web platform)

## Deliverable

`packages/dart_monty_web` -- Flutter web plugin implementing `dart_monty`.

## Usable For

Flutter web apps.

## Work Items

### 6.1 Federated Registration

`packages/dart_monty_web/pubspec.yaml`:
```yaml
flutter:
  plugin:
    implements: dart_monty
    platforms:
      web:
        pluginClass: DartMontyWeb
        fileName: dart_monty_web.dart
```

Root pubspec adds:
```yaml
flutter:
  plugin:
    platforms:
      web:
        default_package: dart_monty_web
```

### 6.2 Implementation

- [ ] Wraps `dart_monty_wasm` (pure Dart, from M4)
- [ ] Script injection in `registerWith()` (load bridge JS dynamically)
- [ ] No Isolate needed -- web execution is async by nature
- [ ] COOP/COEP header documentation for deployment

### 6.3 Automated Tests

- [ ] `tool/test_web.sh`:
  1. Build JS wrapper (from M4)
  2. `flutter test --platform chrome packages/dart_monty_web`
- [ ] Test: run, iterative, snapshots, resource limits, errors
- [ ] Integration: example app in headless Chrome

## Quality Gate

```bash
cd packages/dart_monty_web
flutter pub get
dart format --set-exit-if-changed .
flutter analyze --fatal-infos
flutter test --platform chrome --coverage
# Coverage must be >= 90%

cd ../../example
flutter run -d chrome
```

## Test Dependencies

| Tool | Purpose |
|------|---------|
| Flutter SDK | Plugin framework |
| Chrome (headless) | Browser test runner |
| JS wrapper from M4 | Monty WASM bridge |
