# =============================================================================
# DCM Configuration - Stage 2: Aggressive Rules & Tight Metrics
# =============================================================================
# Documentation: https://dcm.dev/docs/configuration
# =============================================================================

dcm:
  # ---------------------------------------------------------------------------
  # Metrics Thresholds (tightened from Stage 1 baselines)
  # ---------------------------------------------------------------------------

  metrics:
    cyclomatic-complexity:
      threshold: 10

    lines-of-code:
      threshold: 50

    number-of-parameters:
      threshold: 6

    maximum-nesting-level:
      threshold: 4

  # ---------------------------------------------------------------------------
  # Exclusions
  # ---------------------------------------------------------------------------

  exclude:
    metrics:
      - "**/*.g.dart"
      - "**/*.freezed.dart"
      - "build/**"
      - "native/**"
      - "test/**"
    rules:
      - "**/*.g.dart"
      - "**/*.freezed.dart"

  # ---------------------------------------------------------------------------
  # Rules
  # ---------------------------------------------------------------------------

  rules:
    # --- Common Anti-Patterns ---
    - avoid-unused-parameters
    - avoid-nested-conditional-expressions
    - avoid-missing-enum-constant-in-map
    - avoid-unnecessary-type-assertions
    - avoid-unnecessary-type-casts
    - avoid-unrelated-type-assertions
    - avoid-redundant-async
    - avoid-duplicate-exports
    - avoid-collection-methods-with-unrelated-types
    - avoid-passing-async-when-sync-expected

    # --- Style & Formatting ---
    - prefer-match-file-name:
        exclude:
          - "test/**"
          - "lib/**/native_bindings.dart"
          - "lib/**/wasm_bindings.dart"
    - prefer-immediate-return
    - prefer-commenting-analyzer-ignores
    - prefer-conditional-expressions
    - prefer-trailing-comma
    - prefer-moving-to-variable
    - newline-before-return
    - no-boolean-literal-compare
    - no-empty-block
    - no-equal-then-else
    - prefer-first
    - prefer-last
    - binary-expression-operand-order
    - double-literal-format

    # --- Null Safety & Types ---
    - avoid-late-keyword:
        exclude:
          - "test/**"
    # Note: fromJson factories use Map<String, dynamic> per Dart convention.
    # Excluding DTO files from avoid-dynamic is intentional.
    - avoid-dynamic:
        exclude:
          - "test/**"
          - "lib/**/*exception.dart"
          - "lib/**/*result.dart"
          - "lib/**/*usage.dart"
          - "lib/**/*limits.dart"
          - "lib/**/*progress.dart"
    - avoid-non-null-assertion:
        exclude:
          - "lib/src/monty_platform.dart"

    # --- Architecture Safety ---
    - avoid-banned-imports:
        entries:
          - paths: ["lib/"]
            deny: ["package:flutter/material.dart", "package:flutter/widgets.dart", "package:flutter/cupertino.dart"]
            message: "This is a pure Dart platform interface. Do not import Flutter widgets."
    - avoid-global-state:
        exclude:
          - "lib/src/monty_platform.dart"

    # --- Member Ordering ---
    - member-ordering:
        order:
          - constructors
          - public-fields
          - private-fields
          - get-setters
          - public-methods
          - private-methods
          - overridden-methods

    # --- Testing ---
    - prefer-test-matcher
    - prefer-correct-test-file-name:
        exclude:
          - "**/python_ladder_runner.dart"
