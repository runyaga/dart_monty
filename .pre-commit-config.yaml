repos:
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: no-commit-to-branch
        args: ["--branch", "main", "--branch", "master"]
      - id: check-merge-conflict
      - id: check-toml
      - id: check-yaml
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.30.0
    hooks:
      - id: gitleaks
  - repo: local
    hooks:
      - id: dart-format
        name: dart format
        entry: dart format --set-exit-if-changed
        language: system
        types: [dart]
      - id: dart-analyze-packages
        name: dart analyze packages
        entry: python3 tool/analyze_packages.py
        language: system
        pass_filenames: false
      - id: dcm-analyze
        name: dcm analyze
        entry: dcm analyze .
        language: system
        pass_filenames: false
      - id: dart-test-platform-interface
        name: dart test (platform_interface)
        entry: bash -c 'cd packages/dart_monty_platform_interface && dart test'
        language: system
        pass_filenames: false
      - id: flutter-test-desktop
        name: flutter test (desktop)
        entry: bash -c 'cd packages/dart_monty_desktop && flutter test'
        language: system
        pass_filenames: false
      - id: flutter-analyze-desktop
        name: flutter analyze (desktop)
        entry: bash -c 'cd packages/dart_monty_desktop && flutter analyze --fatal-infos'
        language: system
        pass_filenames: false
      - id: flutter-test-web
        name: flutter test (web)
        entry: bash -c 'cd packages/dart_monty_web && flutter test --platform chrome'
        language: system
        pass_filenames: false
      - id: flutter-analyze-web
        name: flutter analyze (web)
        entry: bash -c 'cd packages/dart_monty_web && flutter analyze --no-fatal-warnings --fatal-infos'
        language: system
        pass_filenames: false
      - id: cargo-fmt
        name: cargo fmt
        entry: bash -c 'cd native && cargo fmt --check'
        language: system
        files: ^native/
        pass_filenames: false
      - id: cargo-clippy
        name: cargo clippy
        entry: bash -c 'cd native && cargo clippy -- -D warnings'
        language: system
        files: ^native/
        pass_filenames: false
      - id: cargo-test
        name: cargo test
        entry: bash -c 'cd native && cargo test'
        language: system
        files: ^native/
        pass_filenames: false
      - id: cargo-tarpaulin
        name: cargo tarpaulin (90% coverage)
        entry: bash -c 'cd native && OUTPUT=$(cargo tarpaulin 2>&1) && echo "$OUTPUT" && PCT=$(echo "$OUTPUT" | grep -oE "[0-9]+\.[0-9]+% coverage" | grep -oE "[0-9]+\.[0-9]+" | tail -1 || echo "0") && WHOLE=${PCT%%.*} && [ "${WHOLE:-0}" -ge 90 ]'
        language: system
        files: ^native/
        pass_filenames: false
        stages: [pre-push]
  - repo: https://github.com/jackdewinter/pymarkdown
    rev: v0.9.35
    hooks:
     - id: pymarkdown
       args:
        - "--set"
        - "extensions.front-matter.enabled=$!True"
        - "--disable-rules"
        - "MD013,MD024,MD033,MD036,MD041,MD060"
        - "scan"
